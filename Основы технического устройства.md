# Основы технического устройства

В данном разделе кратко рассматриваются ключевые технологии, на которые опирается Obscuro.

Мы рекомендуем прочитать раздел "Доверенная Среда Исполнения", поскольку в нем вводятся понятия и обозначения, используемые на протяжении всей статьи.

## Ethereum
Ethereum - это открытая, прозрачная, не централизованная система блокчейна с сетью нод, поддерживающая смарт-контракты на основе учетных записей, где логика бизнеса может быть развернута в виде кода для создания неизменяемого и не подлежащему цензурированию контракта, который может удерживать и контролировать перемещение активов. Основная сеть Ethereum была запущена в 2015 году и является наиболее зрелой и общепринятой системой смарт-контрактов. Подробнее прочитать можно на официальном [сайте](https://ethereum.org/en/).

## Доверенная Среда Исполнения / TEE
TEE - это защищенная область центрального процессора или CPU. Она гарантирует, что код и данные, загруженные в нее, будут защищены в отношении конфиденциальности и целостности в процессе их обработки. Obscuro изначально фокусируется на SGX от Intel, основываясь на 5-летнем опыте команды по разработке конфиденциального вычислительного продукта с его использованием. Данные TEE не могут быть прочитаны или обработаны за пределами анклава, включая процессы, запущенные на более высоких уровнях привилегий на том же устройстве.

Процессор с поддержкой SGX имеет два корневых ключа устройства, которые вшиты в него производителем: _Корень Ключа Обеспечения_ (RPK) и _Корень Ключа Закрытия_ (RSK). RPK стал известен благодаря Intel и используется для подтверждения подлинности процессора посредством удаленной аттестации, а RSK в свою очердеь не известен никому за пределами процессора. Эти ключи могут быть использованы для создания других ключей для конкретных процессоров. В данном документе мы будем называть их как _Ключ Анклава_ (EK). Процессы и пользователи вне анклава шифруют данные, предназначенные только для анклава, с помощью ключей, созданных внутри анклава. Когда анклав хочет сохранить данные, они снова шифруются, чтобы устройство (сервер, на котором хранятся данные) не смогло их увидеть.

Проверка позволяет пользователю убедиться в том, что анклав работает на настоящем процессоре с поддержкой функции SGX, которая корректно пропатчена, а приложение, работающее внутри анклава, соответствует определенной кодовой базе и не является взломанным, прежде чем пользователь поделится с ним конфиденциальными данными. Это позволяет пользователю или доверенному лицу заранее проверить код приложения и быть уверенным, что только этот код сможет увидеть данные.

В случае с Obscuro, приложение SGX представляет из себя виртуальную машину, в значительной степени совместимую с EVM, позволяющую исполнять существующие смарт-контракты Ethereum вместе с функцией роллапов, необходимой для взаимодействия с L1 контрактом.

_Доверенная Вычислительная База_ (TCB) определяется как набор вычислительных технологий, которые должны работать исправно и не быть вредоносными или скомпрометированными для работы в системе безопасности. TCB состоит из аппаратного TCB (CPU) и программного TCB (микрокод CPU и приложения). Проверка предоставит проверяющему отчет, содержащий подробную информацию обо всех компонентах TCB, таких как тип CPU, номер версии безопасности SGX (CPUSVN) и версию приложения.

Отчет по проверке, который считался безопасным, может стать небезопасным, если будет раскрыта какая-либо уязвимость. В этот момент система должна быть заново защищена. Для этого разработан процесс под названием TCB восстановление.

В данном документе, под понятием _Аттестационный Отчет_ (AR), понимается общий объект, описывающий TCB и содержащий ключ шифрования, под названием _Проверяющий Ключ_ (AK), а под _Ограничениями при Проверке_ (AC) - набор ограничений, которым должен удовлетворять отчет, чтобы считаться безопасным в определенный момент времени. Ограничения будут меняться со временем по мере обнаружения уязвимостей, обновления программного обеспечения новыми функциями или в соответствии с развитием EVM. Ноды Obscuro должны будут обновляться, чтобы продолжать участвовать в сети.

Любое сообщение, исходящее из анклава, может быть подписано благодаря АК. Это является гарантией для получателя, что сообщение должно быть отправлено только из корректного анклава.

Приведенная ниже диаграмма представляет из себя концептуальный обзор механизма, с помощью которого TEE производитель и группа аудиторов безопасности, распространяют доверие для результатов вычислений, выполняемых внутри TEE.

![tee architecture](./images/tee-architecture.png)

Подпись от EK подтверждает, что подписанный пакет данных исходит от реального CPU. Этого недостаточно для вывода типичных конфиденциальных вычислений в различных ситуациях, поскольку клиенты должны знать, какая программа работает на CPU и какая у него прошивка.

Чтобы решить эту проблему, TEE генерирует новый ключ (AK), полученный из RSK, который впоследствии включается в Аттестационный Отчет вместе с версиями программного и аппаратного обеспечения, и далее подписывает этот отчет благодаря EK.

## Роллапы
Два основных подхода к масштабированию L1 блокчейна заключаются в том, чтобы повысить мощность блокчейна или перенести обработку из него, но при этом, быть зависимым от него самого.

Первый подход может сделать блокчейн более централизованным, поскольку ценность инфраструктуры нод увеличивается (ограничивая число участников, способных себе это позволить) или уменьшается число нод, участвующих в консенсусе. Другой вариант - разделение счетов на шарды, что позволяет проводить валидацию параллельно, и это текущий подход, предусмотренный в дорожной карте Eth2.

Второй подход заключается в том, чтобы позволить пользователям работать с контрактами на втором уровне сети нод, где выполняется большая часть работы по обработке. Одним из примеров второго подхода являются роллапы, когда транзакции в L2 проверяются и размещаются в сжатом виде в одной транзакции роллапа в L1 блокчейне. Существует контракт L1, который обрабатывает депозиты и снятие средств. В роллапах с нулевым знанием, ноды L1 могут предпринять легкий процесс проверки корректности действий в сети L2, тогда как в оптимистичных роллапах предполагается, что представленные транзакции на L2 являются достоверными, но другая нода на L2 может опровергнуть их во время свободного окна проверки.
