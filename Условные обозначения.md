# Условные обозначения
## Контрибуторы
Проект Obscuro является децентрализованным по своей природе, и этот технический документ наполнился благодаря отзывам следующих авторов:
* Richard Gendal Brown
* Mike Hearn
* Moritz Platt
* Tim Brinded
* Fred Dalibard
* Stefan Iliev
* Zbigniew Czapran

Дополнительные отзывы приветствуются, и все рецензенты будут отмечены.

## Глоссарий
**Агрегатор** - нода, участвующая в сети L2 и сотрудничающая с другими нодами-агрегаторами для управления контрактами L2 и подтверждения корректности транзакций. В частности, она участвует в сплетнях транзакций и может предлагать роллап транзакции для регистрации в блокчейне на L1.

**Аттестационные Ограничения(Attestation Constraints)**
Означают контроль над тем, какое программное обеспечение разрешено запускать в доверенной среде исполнения.

**Автоматический Маркет Мейкер / AMM**
Использует пулы ликвидности, позволяющие торговать цифровыми активами автоматически и без разрешений.

**Вознаграждение за блок (Block Reward)**
Количество OBX, которое выдается операторам нод для покрытия их расходов на проверку и публикацию блоков.

**Ключ Анклава / EK**
Коллекция из одного или нескольких криптографических ключей, используемых для шифрования и расшифровки данных, уникальных для конкретного анклава, цифровой подписи данных и идентификации доверенной среды исполнения.

**ERC-20**
Ethereum Request for Comments 20, предложенный Фабианом Фогельштеллером в ноябре 2015 года, - это стандарт токенов, реализующий API для токенов в рамках смарт-контрактов.

**Виртуальная Машина Ethereum / EVM**
Виртуальный компьютер, существование которого поддерживается тысячами подключенных компьютеров из реального мира, на которых запущен клиент Ethereum.

**Газ (Gas)**
Единица измерения количества вычислительных усилий, необходимых для выполнения определенных операций в сети Ethereum.

**Ценообразование газа (Gas Price)**
Плата, взимаемая за каждое вычисление, выполняемое в сети Ethereum, для поощрения хорошего поведения, например, для предотвращения спама в сети со стороны плохих игроков.

**Генезис Анклава (Genesis Enclave)**
Это первая Доверенная Среда Исполнения, присоединившаяся к новой сети. Генезис Анклава распространяет основную seed на другие аттестованные ноды, шифруя его с помощью специальных ключей Доверенной Среды Исполнения (Trusted Execution Environment).

**Хост**
Сторона, контролирующая физический сервер, на котором работает Доверенная Среда Исполнения. В модели рисков у типичных приложений для конфиденциальных вычислений, включая Obscuro, хост является противником системы.

**Контракт Управления на L1**
Смарт-контракт, который работает на Ethereum и обрабатывает все проблемы на стороне L1.

**Уровень 1 / L1**
Открытый блокчейн Ethereum и его сеть.

**Уровень 2 / L2**
Вторая сеть, построенная поверх сети L1 и зависящая от нее. Сеть L2 расширяет возможности сети L1 за счет увеличения пропускной способности или расширения функциональности.

**Максимально Извлекаемая Ценность / MEV**
Участники сети могут извлекать ценность, наблюдая за транзакциями пользователей, а затем вытеснять их, продвигая свою собственную транзакцию вперед по очереди обработки и влияя на цену актива с целью извлечения прибыли.

**Не-Взаимозаменяемый Токен / NFT**
Уникальная и не-взаимозаменяемая единица данных, хранящаяся в цифровом распределенном реестре.

**Публичные События Obscuro**
Специальные события, выпускаемые контрактами на L2, которые включаются в роллапы в открытом виде и становятся известны контрактам на L1, когда роллапы достигают финальной стадии. Это механизм, с помощью которого Obscuro может публиковать информацию.

**OBX**
Утилити-токен, используемый в Obscuro.

**Деятельность вне-цепи**
Действия происходят вне L1 блокчейна.

**Оптимистический роллап (Optimistic Rollup)**
Оптимистический роллап предполагает, что все транзакции корректны, и отправляет батчи без выполнения каких-либо вычислений. Они включают период оспаривания, в течении которого, любой может оспорить легитимность данных, содержащихся в батчах. Если обнаруживается мошенническая транзакция, роллап выполняет так называемое доказательство мошенничества и выполняет верное вычисление транзакции, используя данные, доступные на L1.

**Торговля вне биржи / OTC**
Место для предоставления индивидуальных финансовых соглашений или опционов, заключенных между контрагентами, в отличие от листинга на бирже.

**Корень Дерева Патриция**
Дерево Патриции - это структура данных, используемая в модели Ethereum для представления дерева поступления, состояния мира, хранения счета и транзакций. В блоке Ethereum хранится только корень ноды, и он представляет собой одно криптографическое доказательство для общего состояния.

**Доказательство Включенности Блока / POBI**
Obscuro - новый децентрализованный протокол консенсуса на основе раундов, основанный на честной лотерее и синхронизирован с L1, предназначенный для роллапов на L2.

**Роллапы**
L2 - это решение, которое выполняет транзакции вне основной цепи L1, но размещает данные о транзакциях на L1. Роллап - это пакет транзакций, который был выполнен проверяющим на L2.

**Корень Ключа Обеспечения / RPK**
Криптографический ключ, произвольно создаваемый и хранящийся у корпорации Intel. Это является основой того, что процессор демонстрирует, насколько он является настоящим процессором Intel SGX на определенной доверенной вычислительной базе.

**Корень Ключа Закрытия / RSK**
Криптографический ключ, уникальный для анклава, который этот анклав использует для шифрования и расшифровки данных, хранящихся за пределами границы анклава.

**Секвенсор**
Секвенсор - это выбранный агрегатор, который создает роллап в раунде.

**SGX**
Расширение для защиты в лице ПО (SGX) - это технология, предоставляемая Intel, являющихся одними из основных производителей CPU. Процессор на SGX имеют доступ к зашифрованным вычислениям, к которым оператор не имеет доступа, так как он защищен закрытым ключом, записанным в процессоре при производстве.

**Смарт контракт / Контракт**
Пользовательское приложение, работающее в сети блокчейна, которое хранит данные или переменные, отвечающин на команды пользователя, а также оно может хранить и управлять активами или деньгами.

**Стейк (Stake)**
Незначительная сумма, которая передается для осуществления деятельности или процесса, чтобы продемонстрировать готовность, чтобы следовать правилам этой деятельности или процесса.

**Доверенная Среда Исполнения / TEE**
Среда, в которой контракты могут управляться заранее заданным алгоритмом, повторяемым и проверяемым способом на основе набора доверительных зависимостей.

**Доверенная Вычислительная База / TCB**
Набор вычислительных технологий, которые должны работать исправно, не быть вредоносными или скомпрометированными для работы в системе безопасности.

**Утилити-Токен**
Токены, предназначенные для предоставления цифрового доступа к приложению или услуге.

**Проверяющий**
Проверяющая _Лайт_-нода на L2, которая наблюдает за транзакциями роллапов, публикуемых в L1 блокчейне, может участвовать в возможных спорах. Любой проверяющий может стать агрегатором, зарегистрировавшись на контракте в L1 и внеся определенный стейк.

**ZK-роллапы**
Роллапы на основе нулевого знания генерируют криптографические доказательства, которые могут быть использованы для подтверждения истинности транзакций.

## Модель данных
На этой диаграмме показана структура данных для Управляющего Контракта и Агрегатора:
![management-contract](./images/management-contract.png)

На этой диаграмме показана структура данных для роллапа и вывода средств:
![rollup](./images/rollup.png)

На этой диаграмме показана структура данных для транзакций и счетов:
![transaction-account](./images/transaction-account.png)

## Альтернативные решения
В этом разделе описываются рассмотренные и отброшенные альтернативы.

### Альтернативное управление депозитами на L1
На высоком уровне, пользователь должен внести ERC токены  на контракт управления L1, и та же сумма должна быть зачислена на счет пользователя в сети Obscuro. Это не так просто, поскольку конечный результат является не сто процентным. Одним из вариантов достижения этой цели является ожидание подтверждения в течение нескольких блоков на L1. Это имеет ряд очевидных недостатков.

Другой вариант - ввести механизм зависимости между роллапами L2 и блоками L1. По сути, транзакция L2, зачисляющая на счет в сети Obscuro, будет находиться в свернутом блоке L2, который будет принят Управляющим Контрактом только в том случае, если зависимость является частью начала текущего блока. Этот вариант отбрасывается, поскольку в случае, если депозит в L1 реорганизуется до создания роллапа, то сам роллап, содержащий транзакцию депозита в L2, становится недействительным.

### Альтернативное предотвращение кражи в L1
Существует пул ликвидности, хранящийся в контракте моста в L1, который контролируется группой TEE, поддерживающих зашифрованный распределенный реестр собственности. Некоторые пользователи захотят выйти из L2 и вернуться в L1, что означает, что Управляющий Контракт должен будет позволить им требовать деньги из пула ликвидности.

В случае, если один из агрегаторов сможет взломать TEE, он сможет представить доказательство того, что владеет гораздо большей суммой, и таким образом управлять ею.

Для решения этой проблемы у нас есть несколько вариантов. Мы можем организовать агрегаторов в BFT и потребовать, чтобы 2/3 из них подписывали каждый роллап. Основной недостаток этого подхода заключается в том, что окончательность транзакции в L2 будет зависеть как от окончательности BFT, так и от окончательности в L1. Другим недостатком является то, что решительный хакер, обладающий средствами для взлома защищенного оборудования, может также накопить большую часть от общего стейка и остаться на вершине.

Другой вариант с лучшей моделью доверия - введение механизма вызова, аналогичного оптимистичным роллапам. Недостатком является то, что он вводит время задержки и концепцию вероятностного окончания.

Структура данных, содержащая роллапы, представляет собой цепь, которая может иметь несколько вершин. Управляющий контракт не может оценить, какая из них истинная, потому что он не может выполнять транзакции внутри нее. Но есть несколько простых правил, которые можно применить. Например, если ветвь не продвигается в течение N-блоков, она считается мертвой. Если в момент выхода есть только одна активная главная ветвь, то системе достаточно подождать разумное количество блоков (20-50), чтобы убедиться, что на L1 нет попытки цензуры. Если есть форк, то количество блоков должно быть увеличено, чтобы позволить одному из форков умереть естественным образом. Если этого не произойдет, то все снятия будут заблокированы, а контракт перейдет в специальную процедуру.

### Альтернативные Варианты Разглашения
Решение будет раскрывать все транзакции по истечении одного года с помощью процесса ротации ключей. Альтернативной политикой может быть указание доли транзакций (например, 1%), которые раскрываются либо сразу, либо вдальнейшем. Обнаружение незаконных транзакций тогда становится основанным на риске, но коэффициент не может быть достаточно высоким, чтобы быть сдерживающим фактором и в то же время приносить пользу.

### Альтернативная Генерация Nonce (случайных одноразовых чисел)
Хост-агрегатор не должен иметь возможность многократно отправлять доказательство роллапа в TEE, чтобы получить новое случайное число, и, таким образом, добиться наименьшего числа, чтобы выиграть раунд выбора агрегатора. Также рассматривались постоянные счетчики, но альтернативой является созданное благодаря заранее заданному алгоритму одноразовое число. Одноразовое число выводится из хэша блока L1, благодаря алгоритму в сочетании с открытым ключом анклава. Это достигает той же цели - являться честной лотереей, предполагая отсутствие сговора между майнерами в L1 и агрегаторами в L2. Даже если сговор существует, стоимость игры с хэшем в L1, может быть слишком высокой в сети с Proof of Work. В сети с _Proof of Stake_, с другой стороны, сговор с L1 будет означать, что в каждом раунде победитель L1 будет выигрывать и раунд L2.


### Альтернативное Разглашение Приватности
Существует несколько вариантов раскрытия приватных данных, чтобы позволить правоохранительным органам преследовать незаконное поведение и удержать преступников от использования возможностей Obscuro по обеспечению приватности:
* Не делать положения о раскрытии на том основании, что Obscuro является платформой и не имеет отношения к тому, для чего она используется.
* Ключ шифрования транзакций может быть перемещен и раскрываться периодически с задержкой, так что любая заинтересованная сторона может просмотреть все транзакции. Мы выбрали именно это решение, но с некоторой гибкостью на уровне приложений.
* Управляющий комитет может утвердить некоторые анклавы для добычи данных, которые будут иметь доступ к общему secret и будут выявлять подозрительную активность.


С самого начала Obscuro будет ежегодно менять ключ шифрования и раскрывать исторические ключи на первом этапе, а позже решит, нужны ли дополнительные механизмы. Раскрытие в каждом конкретном случае, на основании требований властей, занимает много времени и подвержено политическому вмешательству. Кроме того, трудно объективно определить, что является добросовестным авторитетом, что создает политическую дилемму.

[Page history]({{ site.github.repository_url }}/blame/main/{{page.path}})
